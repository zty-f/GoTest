user  root;
worker_processes  1;
error_log  /www/wwwlogs/nginx_error.log  crit;
pid        /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;

stream {
    log_format tcp_format '$time_local|$remote_addr|$protocol|$status|$bytes_sent|$bytes_received|$session_time|$upstream_addr|$upstream_bytes_sent|$upstream_bytes_received|$upstream_connect_time';
  
    access_log /www/wwwlogs/tcp-access.log tcp_format;
    error_log /www/wwwlogs/tcp-error.log;
    include /www/server/panel/vhost/nginx/tcp/*.conf;
}

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;
		#include luawaf.conf;

		include proxy.conf;

        default_type  application/octet-stream;

        server_names_hash_bucket_size 512;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
		fastcgi_intercept_errors on;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        limit_conn_zone $binary_remote_addr zone=perip:10m;
		limit_conn_zone $server_name zone=perserver:10m;

        server_tokens off;
        access_log off;

#wiki前端配置
    server {
             listen 80;
             #server_name 47.108.239.8;
             server_name wiki.zruler.fun;

             location / {
                alias /root/web/; #root绝对路径 alias目录
                index index.html;
                try_files $uri $uri/ /index.html;
             }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

    # tutor前端配置
    server {
            listen       80;
            server_name  tutor.zruler.fun;
    		location / {
                root   /root/tutor/web;
    			try_files $uri $uri/ /index.html;
                index  index.html index.htm;
            }

    		location /prod-api/ {
    			proxy_set_header Host $http_host;
    			proxy_set_header X-Real-IP $remote_addr;
    			proxy_set_header REMOTE-HOST $remote_addr;
    			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    			proxy_pass http://localhost:9999/;
    		}

            error_page   500 502 503 504  /50x.html;
            location = /50x.html {
                root   html;
            }
        }

    # 大数据期末股票数据可视化vue项目部署
    server {
                 listen 80;
                 server_name stock.zruler.fun;

                 location / {
                    alias /root/stockweb/; #root绝对路径 alias目录
                    index index.html;
                    try_files $uri $uri/ /index.html;
                 }

            error_page   500 502 503 504  /50x.html;
            location = /50x.html {
                root   html;
            }
        }

    server{
         listen 80;
         #server_name 47.108.239.8;
         server_name wiki-server.zruler.fun;

         location / {
             proxy_pass http://47.108.239.8:8081;
             #针对websocket，需要增加下面的配置
             proxy_redirect off;
             proxy_http_version 1.1;
             proxy_set_header Upgrade $http_upgrade;
             proxy_set_header Connection "upgrade";
             proxy_set_header Host $host:$server_port;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

             #代理时长设置600秒，默认60秒，websocket超时会自动断开
             proxy_read_timeout 600s;
         }
    }

    server{
             listen 80;
             #server_name 47.108.239.8;
             server_name smbms.zruler.fun;

             location / {
                proxy_pass http://47.108.239.8:8080;
             }
    }

    server {
                 listen 80;
                 #server_name 47.108.239.8;
                 server_name seckill.zruler.fun;

                 location / {
                    proxy_pass http://47.108.239.8:8088;
                 }
    }
    server {
                     listen 80;
                     #server_name 47.108.239.8;
                     server_name tiktok.zruler.fun;
                     return 301 https://jnwedld8az.feishu.cn/docx/L5DAdUECyoy5fgxDpy0cBTZ7nsc;
        }

    server {
                         listen 80;
                         #server_name 47.108.239.8;
                         server_name study.zruler.fun;
                         return 301 https://jnwedld8az.feishu.cn/docx/BbRtdtQWpoRuJwxqt3wcyKT7nbe;
            }
    
#     #以下属性中，以ssl开头的属性表示与证书配置有关。
#     server {
#         listen 443 ssl;
#         #配置HTTPS的默认访问端口为443。
#         #如果未在此处配置HTTPS的默认访问端口，可能会造成Nginx无法启动。
#         #如果您使用Nginx 1.15.0及以上版本，请使用listen 443 ssl代替listen 443和ssl on。
#         server_name www.zty-f.fun;
#         root html;
#         index index.html index.htm;
#         ssl_certificate cert/8970000_www.zty-f.fun.pem;
#         ssl_certificate_key cert/8970000_www.zty-f.fun.key;
#         ssl_session_timeout 5m;
#         ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
#         #表示使用的加密套件的类型。
#         ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; #表示使用的TLS协议的类型，您需要自行评估是否配置TLSv1.1协议。
#         ssl_prefer_server_ciphers on;
#         location / {
#                     proxy_pass http://zty-f.fun/;
#                  }
#     }


server
    {
        listen 888;
        server_name phpmyadmin;
        index index.html index.htm index.php;
        root  /www/server/phpmyadmin;

        #error_page   404   /404.html;
        include enable-php.conf;

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /www/wwwlogs/access.log;
    }
include /www/server/panel/vhost/nginx/*.conf;
}

